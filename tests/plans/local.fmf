summary: a-i-b tests running on local machine

environment:
    # Full path to the directory with cloned repository of the project
    PROJECT_DIR: ""

    # Distribution used inside tests.
    # Available distributions can be listed using `automotive-image-builder list-dist` on the relevant platform.
    AIB_DISTRO: autosd10-sig

    AIB: $PROJECT_DIR/automotive-image-builder
    AIB_BASEDIR: $PROJECT_DIR
    AIR: $PROJECT_DIR/automotive-image-runner
    OUTDIR: /var/tmp/tmt
    BUILDDIR: $OUTDIR/build
    BUILDCACHEDIR: $OUTDIR/build-cache
    RUNDIR: $OUTDIR/run

provision:
    how: local

prepare:
    - name: Install required packages
      how: install
      package:
        - jq

    - name: Setup local environment
      how: shell
      script: |
          ./scripts/setup-local.sh

    - name: Report a-i-b version
      how: shell
      script: |
         ${AIB} --version

    - name: Report a-i-b version
      how: shell
      script: |
          rpm -qi automotive-image-builder

    - name: Populate build cache directory
      how: shell
      script: |
          ./scripts/init-build-cache.sh

discover:
    how: fmf
    filter: tag:-special

execute:
    how: tmt

report:
    how: junit

finish:
    - name: Cleanup temporary files
      how: shell
      script: |
          ./scripts/cleanup.sh
